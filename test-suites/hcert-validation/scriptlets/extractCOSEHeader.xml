<?xml version="1.0" encoding="UTF-8"?>
<scriptlet id="extractCOSEHeader" xmlns="http://www.gitb.com/tdl/v1/" xmlns:gitb="http://www.gitb.com/core/v1/">
    <metadata>
        <gitb:name>Extract COSE Header</gitb:name>
        <gitb:version>1.0</gitb:version>
        <gitb:description>Scriptlet to extract COSE header and algorithm claim from CWT</gitb:description>
    </metadata>
    
    <params>
        <var name="cwtToken" type="string"/>
    </params>
    
    <outputs>
        <var name="coseHeader" type="string"/>
        <var name="algorithmClaim" type="string"/>
    </outputs>
    
    <steps>
        <!-- Parse CWT and extract COSE header -->
        <call id="parseCWT" desc="Parse CWT token"
              handler="$DOMAIN{processingServiceAddress}">
            <input name="operation">"parseCWT"</input>
            <input name="cwtData">$cwtToken</input>
        </call>
        
        <!-- Extract algorithm claim (claim '1') from header -->
        <call id="extractAlgorithm" desc="Extract algorithm claim"
              handler="$DOMAIN{processingServiceAddress}">
            <input name="operation">"extractClaim"</input>
            <input name="coseData">$parseCWT{coseHeader}</input>
            <input name="claimKey">"1"</input>
        </call>
        
        <assign to="coseHeader">$parseCWT{coseHeader}</assign>
        <assign to="algorithmClaim">$extractAlgorithm{claimValue}</assign>
    </steps>
</scriptlet>